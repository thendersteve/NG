VoteBar=function(you_voted_text){var that=this,$=jQuery,form;var afterVote=function(json,status,xhr){if(status===0){}else{var
voted_sentence=PHP.get('you_voted_text').replace('%s',json.vote);form.down('h3').addClass('voted').html(voted_sentence);if(typeof json.rendered_text!==undefined){$('#aftervote').down().html(json.rendered_text);}
$('#aftervote').appear();}};var voteError=function(response,status,xhr){$('#votebar').enable();};this.vote=function(e){var target=$(e.target);if(target.is('LABEL')){if(!PHP.get('user_logged_in',false)){PassportHandler.open().reposition($(document).scrollTop());return false;}
$('#'+ e.target.htmlFor).prop('checked',true);form=target.up('form');var
form_data=form.serializeArray(),url=form.attr('action');form.disable();$.ajax.startWaiting(form,$.ajax({type:'post',url:url,data:form_data,success:afterVote,error:voteError}));}
target=null;};this.init=function(){$('#votebar ul').click(this.vote);$('#votebar').enable();};this.lock=function(){$('#votebar').disable();}};PortalReviewSubmit=function(){var
$=jQuery,form=$('#review_form'),validations={require:[['review_stars','Choose a star rating for this submission.'],['review_body','You must write a review!']]};form.off();if(form.find('#review_agreed').length){validations.require.push(['review_agreed','You must agree to the terms and conditions']);}
var validator=new NgFormValidator(form,validations);this.init=function(){$('#review_form_show').off();$('#review_form_show').click(function(e){var self=$(this);if(self.text()=='Cancel Review'){self.text('Write a Review');}else{self.text('Cancel Review');}
form.toggle();return false;});var reenable=function(){form.enableSubmit();};form.submit(function(e){if(validator.validate()){form.ajaxSubmit(function(text){$('#portal_reviews_container').replaceWith($('#portal_reviews_container',text));form.toggle();$('#review_form_show').hide();});return false;}else{alert(validator.getErrorMessages().join("\n"));}
e.preventDefault();});};};PortalReview=(function($){var instance,container;var portal_review=function(){var initialized=false,voteOnReview=function(e){var label=$(e.target);if(label.is('label')){var
radio=$('#'+ e.target.htmlFor),form_class_names={y:'yes',n:'no',x:'x'},form=label.up('form');;if(!radio.prop('disabled')){radio.prop('checked',true);form.ajaxSubmit(function(response){form.disable().down('span').html(response.message);});return false;}}},showResponseForm=function(){var self=$(this);$(this.href.substr(this.href.indexOf('#'))).toggle();if(-1===self.html().indexOf('Cancel')){self.data('original text',self.html());self.html('Cancel');}else{self.html(self.data('original text'));}
return false;},submitResponse=function(e){var $this=$(this);$this.ajaxSubmit(function(response){var
resp=$(response),authresponse=resp.find('div.authresponse'),modlinks=resp.find('div.modlinks');$this.enable().hide();var review_div=$this.prev('div');review_div.down('div.authresponse').remove();review_div.down('div.modlinks').before(authresponse).replaceWith(modlinks);},{dataType:'html'});return false;},changePage=function(){if(this.href){$.get(this.href,null,function(response){$('#portal_reviews').replaceWith(response);$('#portal_reviews').scrollTo();});return false;}},listenOnReviews=function(){container.off();container.on('click','form.helpful',voteOnReview).on('click','a.respond_to_review',showResponseForm).on('click','div.pagenav a',changePage).on('submit','form[id^="review-response"]',submitResponse);};this.init=function(){if(!initialized){listenOnReviews();initialized=true;}};};return{_:function(reviews_container,reset){instance=new portal_review();container=reviews_container||$('#portal_reviews');return instance;}};})(jQuery);var NgFavorites=(function(){var $=jQuery,in_progress=false,current_form=null;var resetDefaults=function(){in_progress=false;current_form=null;};var handleResponse=function(response){if(response){if($.isString(response)){current_form.replaceWith($(response));}else if(response.url){if(response.success){alert(response.success);}
window.location.href=response.url;}}};var afterWards=function(response){if(null!==current_form){form_id=current_form.attr('id');handleResponse(response);incrementCount(form_id);}
resetDefaults();};var incrementCount=function(id){var count_element=$('#count_'+ id);if(count_element.exists()){if(count_element.children().size()){count_element=count_element.children(count_element.children().size()- 1);}
count_element.html(FormatNumber(parseInt(count_element.html().replace(/[^0-9]+/g,''),10)+ 1)+' Fans');}};var submitForm=function(e){e.stopImmediatePropagation();if(in_progress){alert('Sorry, another form is currently being saved.');return false;}
current_form=$(e.target);in_progress=true;current_form.ajaxSubmit(afterWards,{error:resetDefaults});return false;};return{addListener:function(form_id_or_form){var form;if($.isString(form_id_or_form)){if(form_id_or_form.indexOf('#')!==0){form_id_or_form='#'+ form_id_or_form;}
form=$(form_id_or_form);}else if(form_id_or_form.is('form')){form=form_id_or_form;}else{throw"Don't know how to add this.";}
form.bind('submit',submitForm);}}})();